import { TriggerIntentPayload } from '@bahasa-ai/plugins-core-engine'
import { AddCsatAutocloseAction } from '../../../Action/FCSAT/FCsatAutoclose'
import { F6AskFeedbackReason, SaveCSATAnswer } from '../../../Action/FCSAT/FSurvey'

import LogEvent from '../../../Action/LogEvent'
import { ValidateUserRatingAction } from '../../../Action/{{Action}}Middleware'
import { InitialIntent, PushIntent } from '../../../Bot'
import Response from '../../../Util/Response'
import { InteractiveExpression } from '../../../Util/ReusableExpression'

export class F3SurveyAnswer extends InitialIntent {
  static contextIn = [
    'F3CSATSurvey'
  ]

  static parameter = InteractiveExpression.parameter
  static userExpression = InteractiveExpression.userExpression


  public actions() {
    return this.run(LogEvent)
      .run(AddCsatAutocloseAction)
      .run(ValidateUserRatingAction)
      .run(SaveCSATAnswer)
      .run(F6AskFeedbackReason)
  }
}

export class F3AskSurveyPush extends PushIntent {
  static isContextReplaced = true
  static contextOut = [
    'F3CSATSurvey'
  ]

  public async push(event: EventMiddleware, response: Record<string, any>) {
    return await this.trigger(event, {
      response: Response.merge([response])
    })
  }

  public async pushWithoutEvent(payload: TriggerIntentPayload, response: Record<string, any>) {
    return await this.triggerWithoutEvent(payload, {
      response: Response.merge([response])
    })
  }
}